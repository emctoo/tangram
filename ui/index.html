<!DOCTYPE html>
<!-- <meta http-equiv="Cache-Control" content="no-cache"> -->

<head>
  <title>tangram</title>
  <link href="/favicon/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="/favicon/favicon.png" rel="icon" type="image/png" />

  <!-- Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet" type="text/css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=B612&display=swap" rel="stylesheet" />

  <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"></script>

  <!-- Bootstrap -->
  <script src="https://unpkg.com/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css" />

  <!-- Other various libraries -->

  <script src="https://unpkg.com/arquero@latest/dist/arquero.min.js"></script>
  <script src="https://unpkg.com/chart.js@2.9.3"></script>
  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/d3-hexbin"></script>
  <script src="https://unpkg.com/hammerjs@2.0.8"></script>
  <script src="https://unpkg.com/iso8601-js-period@0.2.1/iso8601.js"></script>
  <script src="https://unpkg.com/moment@2.30.1/min/moment.min.js"></script>
  <script src="https://unpkg.com/@observablehq/plot@latest"></script>
  <script src="https://unpkg.com/phoenix@1.7.11/priv/static/phoenix.min.js"></script>
  <script src="https://unpkg.com/raphael@2.3.0/raphael.min.js"></script>
  <script src="https://unpkg.com/traffic.js@0.0.8/dist/traffic.min.js"></script>
  <script src="https://unpkg.com/morphdom@2.6.1/dist/morphdom.js"></script>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.js"></script>
  <script src="https://unpkg.com/leaflet-rotatedmarker@0.2.0/leaflet.rotatedMarker.js"></script>
  <script src="https://unpkg.com/leaflet-sidebar-v2@3.2.3/js/leaflet-sidebar.min.js"></script>
  <script src="https://unpkg.com/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.min.js"></script>
  <script src="https://unpkg.com/@asymmetrik/leaflet-d3@4/dist/leaflet-d3.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.css" />

  <!-- tangram specific headers -->
  <link rel="stylesheet" href="/css/user.css" />
  <link rel="stylesheet" href="/css/modal.css" />
  <script type="module" src="/js/trajectory.js"></script>
  <!--  modal-->
  <script type="text/javascript" src="/js/modal.js"></script>

  <script type="text/javascript" src="/js/graph.js"></script>
  <script type="text/javascript" src="/js/aircraft_icon.js"></script>

  <!-- FIXME: can't be here -->
  <!-- <script type="text/javascript" src="/js/map_live.js"></script> -->

  <script type="text/javascript" src="/js/map_functions.js"></script>
  <script type="text/javascript" src="/js/plans.js"></script>
  <script type="text/javascript" src="/js/trajectory.js"></script>

  <script type='module'>
    //example
    import trajectory from './js/trajectory.js';
    trajectory.main();
  </script>
</head>

<body>
  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h" style="color: black">tangram</span>
      <button id="modal">Modal</button>
      <ul class="nav nav-tabs navbar-nav">
        <li class="nav-item clock">
          <span id="info_utc"></span>Z | <span id="info_local"></span> <span id="uptime"></span>
        </li>
      </ul>
      <div class="navbar-collapse collapse"></div>
    </div>
  </div>

  <var id="seconds_uptime" hidden="hidden">{{uptime}}</var>

  <div id="container-map">
    <div id="sidebar" class="leaflet-sidebar collapsed">
      <div class="leaflet-sidebar-tabs">
        <ul role="tablist">
          <li>
            <a href="#info_box" role="tab"><span class="fa fa-plane"></span></a>
          </li>
        </ul>
      </div>

      <div class="leaflet-sidebar-content">

        <!-- upated from server -->
        <div class="leaflet-sidebar-pane" id="info_box">
          <table class="info_box_table">
            <thead>
            <tr class="info_header">
              <td colspan="2">Flight Information</td>
            </tr>
            </thead>
            <tbody>
              <tr class="info_label">
                <td>aircraft on map</td>
                <td>
                  <b>
                    <p style="display: inline" id="plane_count"></p>
                  </b>
                </td>
              </tr>
            </tbody>
          </table>

          <table class="info_box_table" id="flight" hidden="true">
            <thead>

            </thead>
            <tbody>
              <tr class="info_label">
                <td>icao24</td>
                <td class="info_value">
                  <p style="display: inline" id="icao24"></p>
                </td>
              </tr>
              <tr class="info_label">
                <td>callsign</td>
                <td class="info_value">
                  <p style="display: inline" id="aircraft_id"></p>
                </td>
              </tr>
            </tbody>
            <tbody>
              <tr class="info_label">
                <td>typecode</td>
                <td>
                  <p style="display: inline" id="typecode"></p>
                </td>
              </tr>
              <tr class="info_label">
                <td>tail</td>
                <td>
                  <p style="display: inline" id="tail"></p>
                </td>
              </tr>
              <tr class="info_label">
                <td>origin</td>
                <td>
                  <p style="display: inline" id="departure"></p>
                </td>
              </tr>
              <tr class="info_label">
                <td>destination</td>
                <td>
                  <p style="display: inline" id="destination"></p>
                </td>
              </tr>
            </tbody>
          </table>

        </div>
        <div class="bottom-bar-info">
          <div colspan="2">System Information</div>
        </div>
      </div>
    </div>

  <div id="map">
    <script type="text/javascript" src="/js/map_live.js"></script>

    <div id="chart-pane" class="leaflet-bar chart-container">
      <select id="plot-select">
        <option value="altitude">Altitude (in ft)</option>
        <option value="speed">Speed (in kts)</option>
        <option value="vertical_rate">Vertical rate (in ft/mn)</option>
        <option value="track">Directions</option>
      </select>
      <div id="chart" class="leaflet-bar chart-container"></div>
    </div>
  </div>
</div>
<script>
  $("#plot-select").on("change", function () {
    whenFeatureSelected(this.value);
  });

  $("#chart-pane").on("click", function (event) {
    // Stop the click event from propagating to the map
    event.stopPropagation();
  });

  // let form_database = document.getElementById("databasebutton");
  // form_database.addEventListener("click", myfunction);
  // form_database.name = "database_form";
  //
  // let form_threshold = document.getElementById("parambutton");
  // form_threshold.addEventListener("click", myfunction);
  // form_threshold.name = "threshold_form";
  //
  // function myfunction(evt) {
  //   let x = document.getElementById(evt.currentTarget.name);
  //   if (x.style.display === "none") {
  //     x.style.display = "block";
  //   } else {
  //     x.style.display = "none";
  //   }
  // }
</script>
</body>
